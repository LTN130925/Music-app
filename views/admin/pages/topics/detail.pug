extends ../../layouts/default

block content
    - const checked = manager.roleId.permissions.listPermission

    if checked.includes('topic_view')
        .container-fluid.py-4
            .card.shadow-sm.border-0.rounded-4
                .card-body.p-4
                    h4.fw-bold.text-dark.mb-4 Chi tiết chủ đề

                    if topic
                        .row.g-4
                            // ===== Ảnh đại diện =====
                            .col-md-4
                                if topic.avatar
                                    img.img-thumbnail.rounded-3.w-100(src=topic.avatar, style='max-height: 250px; object-fit: cover;')
                                else
                                    .border.rounded-3.d-flex.align-items-center.justify-content-center(style='height: 250px; background: #f8f9fa;')
                                        span.text-muted Không có ảnh đại diện

                            // ===== Thông tin cơ bản =====
                            .col-md-8
                                h5.fw-bold.mb-3.text-primary= topic.title
                                p.mb-2
                                    strong.text-secondary Slug:
                                    |
                                    if topic.slug
                                        = ' ' + topic.slug
                                    else
                                        span.text-muted Không xác định

                                p.mb-2
                                    strong.text-secondary Trạng thái:
                                    |
                                    if topic.status === 'active'
                                        span.badge.bg-success.ms-1 Active
                                    else
                                        span.badge.bg-secondary.ms-1 Inactive

                                p.mb-2
                                    strong.text-secondary Ngày tạo:
                                    |
                                    if topic.createdAt
                                        = ' ' + new Date(topic.createdAt).toLocaleDateString('vi-VN')
                                    else
                                        span.text-muted Không xác định

                                p.mb-2
                                    strong.text-secondary Cập nhật gần nhất:
                                    |
                                    if topic.updatedAt
                                        = ' ' + new Date(topic.updatedAt).toLocaleDateString('vi-VN')
                                    else
                                        span.text-muted Không xác định

                                p.mb-2
                                    strong.text-secondary Người tạo:
                                    |
                                    if topic.createdBy && topic.createdBy.managerId && topic.createdBy.managerId.fullName
                                        = ' ' + topic.createdBy.managerId.fullName
                                    else
                                        span.text-muted Không xác định

                            // ===== Mô tả =====
                            .col-md-12
                                hr
                                label.form-label.fw-semibold.mb-2 Mô tả
                                if topic.description
                                    .p-3.border.rounded.bg-light!= topic.description
                                else
                                    p.text-muted Không có mô tả
                        hr.my-3

                        .container
                            .row
                                .col-md-12
                                    form(action=prefixName + `/topic/detail/${topic._id}` method="GET")
                                        .filter-bar(style="display:flex; gap:1rem; align-items:center; margin-bottom:2rem;")

                                            input.form-control(
                                                type="text",
                                                name="search",
                                                placeholder="Tìm bài hát...",
                                                style="flex:1;",
                                                value=(query && query.search ? query.search : "")
                                            )

                                            select.form-select(name="sort" onchange="this.form.submit()")
                                                option(value="") Sắp xếp theo
                                                option(value="name_asc" selected=(query.sort == 'name_asc')) Tên A → Z
                                                option(value="name_desc" selected=(query.sort == 'name_desc')) Tên Z → A
                                                option(value="views_asc" selected=(query.sort == 'views_asc')) Lượt xem ↑
                                                option(value="views_desc" selected=(query.sort == 'views_desc')) Lượt xem ↓
                                                option(value="newest" selected=(query.sort == 'newest')) Mới nhất
                                                option(value="oldest" selected=(query.sort == 'oldest')) Cũ nhất

                                    .mt-3
                                        .song-list
                                            each song in songs
                                                .song-item.d-flex.align-items-center.justify-content-start.border-bottom.p-3
                                                    // Ảnh đại diện bài hát
                                                    .song-avatar(style=`background-image:url('${song.avatar || "/images/default-avatar.png"}'); width: 50px; height: 50px; background-size: cover; background-position: center; border-radius: 50%;`)

                                                    // Thông tin bài hát
                                                    .song-info.flex-grow-1.ms-3
                                                        h5.song-title.mb-1
                                                            a(href=prefixName + `/song/detail/${song._id}`, style="text-decoration:none; color:inherit;")= song.title

                                                        .song-meta.d-flex.align-items-center.text-muted
                                                            span.meta-item.me-3
                                                                i.fas.fa-eye.me-1
                                                                | #{song.views} lượt xem
                                                            span.meta-item
                                                                i.fas.fa-heart.me-1
                                                                | #{song.likes} lượt thích

                                                // Đưa vào khoảng cách dưới mỗi bài hát
                                                hr.my-3
                            hr.my-4
                            .d-flex.justify-content-end.gap-2
                                a.btn.btn-light.border.shadow-sm(href=prefixName + '/topic')
                                    i.fas.fa-arrow-left.me-2
                                    | Quay lại

                                if checked.includes('topic_edit')
                                    a.btn.btn-primary.shadow-sm(href=prefixName + '/topic/edit/' + topic._id)
                                        i.fas.fa-edit.me-2
                                        | Chỉnh sửa
                                else
                                    p.text-danger Không tìm thấy chủ đề.
                    else
                        p Bạn không có quyền truy cập, hãy liên hệ với chủ quản lý!
