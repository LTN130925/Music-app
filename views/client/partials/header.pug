nav.navbar.navbar-dark.bg-dark.fixed-top.shadow-sm.py-2
    .container-fluid.d-flex.align-items-center.justify-content-between
        //- Nút toggle sidebar
        button#toggleSidebar.btn.btn-link.btn-icon(type="button", aria-label="Toggle sidebar", aria-expanded="false")
            i.fas.fa-bars.fa-lg.text-white

        //- Logo
        a.navbar-brand.ml-2.font-weight-bold.text-white(href="/topic") MusicApp

        if user
            //- Nút thông báo
            li.nav-item.dropdown.mx-2
                a#notificationDropdown.nav-link.position-relative.text-white(
                    href="#"
                    role="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                )
                    i.fas.fa-bell.fa-lg

                    //- Badge số lượng thông báo
                    if totalNotifications
                        span.badge.badge-danger.position-absolute(
                            style="top: 0; right: 0; transform: translate(50%, -30%); font-size: 10px;"
                        ) #{totalNotifications}

                //- Dropdown danh sách thông báo
                ul.dropdown-menu.dropdown-menu-right.shadow(aria-labelledby="notificationDropdown")

                    //- Nút X xoá tất cả nằm NGAY TRONG dropdown
                    if user.messageId && user.messageId.listId.length > 0
                        li.px-3.py-2.border-bottom.text-end
                            form(method="POST" action="/notification/remove-all?_method=DELETE" style="display:inline;")
                                button.btn.btn-sm.btn-link.text-danger(type="submit")
                                    i.fas.fa-times #{'   xóa hết tất cả thông báo'}

                    if user.messageId && user.messageId.listId.length > 0
                        each noti in user.messageId.listId
                            li.px-3.py-2.border-bottom.position-relative
                                a.text-dark.text-decoration-none(href=noti.link)
                                    strong #{noti.title}
                                    br
                                    span.text-muted(style="font-size: 12px;") #{noti.description}
                                    br
                                    span.text-muted(style="font-size: 12px;")
                                        | #{noti.createdAt ? new Date(noti.createdAt).toLocaleString('vi-VN') : '00:00'}
                                    br
                                    span.text-muted(style="font-size: 12px;") #{noti.seen === false ? 'chưa đọc' : 'đã đọc'}

                        li.text-center.p-2
                            a.text-primary(href="/notifications") Xem tất cả
                    else
                        li.p-3.text-center.text-muted Không có thông báo mới


        //- Menu phải
        ul.navbar-nav.ml-auto.d-flex.flex-row.align-items-center
            if !user
                li.nav-item.mx-2
                    a.nav-link.text-white(href="/auth/register") Đăng kí
                li.nav-item.mx-2
                    a.nav-link.text-white(href="/auth/login") Đăng nhập
            else
                li.nav-item.dropdown
                    a.nav-link.dropdown-toggle.text-white#userDropdown(
                        href="#"
                        role="button"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false"
                    )
                        if user.avatar
                            img.rounded-circle.mr-2(src=user.avatar, alt="avatar", width="28", height="28")
                        else
                            i.fas.fa-user-circle.fa-lg.mr-1
                        | #{user.fullName || user.email}
                    ul.dropdown-menu.dropdown-menu-right(aria-labelledby="userDropdown")
                        li
                            a.dropdown-item(href="/profile") Hồ sơ cá nhân
                        li.divider.dropdown-divider
                        li
                            a.dropdown-item(href="/profile/change-password") Thay đổi mật khẩu
                        li.divider.dropdown-divider
                        li
                            a.dropdown-item.text-danger(href="/auth/logout") Đăng xuất
